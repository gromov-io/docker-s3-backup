> [!WARNING]
> **–≠—Ç–æ –∑–µ—Ä–∫–∞–ª–æ!** –û—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: [https://gromlab.ru/gromov/docker-s3-backup](https://gromlab.ru/gromov/docker-s3-backup)
> 
> GitHub —É—Ç—Ä–∞—Ç–∏–ª —Å—Ç–∞—Ç—É—Å –Ω–∞–¥–µ–∂–Ω–æ–π –ø–ª–æ—â–∞–¥–∫–∏ –¥–ª—è open-source, –ø—Ä–∏–º–µ–Ω—è—è –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –≤–º–µ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ–π—Ç—Ä–∞–ª–∏—Ç–µ—Ç–∞. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∫–æ—Å–Ω—É–ª–∏—Å—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏–∑ –†–æ—Å—Å–∏–∏ (–î–æ–Ω–µ—Ü–∫, –õ—É–≥–∞–Ω—Å–∫, –ö—Ä—ã–º, –•–µ—Ä—Å–æ–Ω—Å–∫–∞—è –æ–±–ª., –ó–∞–ø–æ—Ä–æ–∂—Å–∫–∞—è –æ–±–ª.), –ò—Ä–∞–Ω–∞, –°–∏—Ä–∏–∏, –ö—É–±—ã –∏ –°–µ–≤–µ—Ä–Ω–æ–π –ö–æ—Ä–µ–∏.
> 
> - ‚ö†Ô∏è Pull requests –∏ issues —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
> - üîÑ –ó–µ—Ä–∫–∞–ª–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
> - üö´ –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–¥–µ—Å—å –±—É–¥—É—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω—ã

# Docker S3 Backup

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ Docker-–ø—Ä–æ–µ–∫—Ç–æ–≤ –≤ S3-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.

## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç

- –°–æ–∑–¥–∞—ë—Ç –ø–æ–ª–Ω—ã–π –∞—Ä—Ö–∏–≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤ S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (Yandex Cloud, Timeweb, AWS S3, MinIO)
- –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é cron (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 05:00 –ú–°–ö)
- –•—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –≤–µ—Ä—Å–∏–π –±—ç–∫–∞–ø–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 30)
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –±–µ–∫–∞–ø—ã –≤ –ø–∞–ø–∫—É —Å –∏–º–µ–Ω–µ–º –ø—Ä–æ–µ–∫—Ç–∞: `s3://bucket/project-name/`
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–µ—Ä–≤–∏—Å—ã –ø–µ—Ä–µ–¥ –±–µ–∫–∞–ø–æ–º

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–°–æ–∑–¥–∞–π—Ç–µ `docker-compose.yaml`:

```yaml
services:
  backup:
    image: ghcr.io/gromov-io/docker-s3-backup:latest
    container_name: project-backup
    restart: unless-stopped
    environment:
      - BACKUP_PROJECT_NAME=my-project
      - BACKUP_S3_BUCKET=my-backups
      - BACKUP_S3_ENDPOINT=s3.twcstorage.ru
      - BACKUP_S3_ACCESS_KEY=your_key
      - BACKUP_S3_SECRET_KEY=your_secret
    volumes:
      - .:/backup-source:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro
```

–ó–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
docker compose up -d backup
```

**–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
- –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å: `Europe/Moscow`
- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ: –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ `05:00`
- –•—Ä–∞–Ω–µ–Ω–∏–µ: `30` –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –≤–µ—Ä—Å–∏–π
- –ü–∞–ø–∫–∞ –≤ S3: `{project-name}/`

## –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –±–µ–∫–∞–ø–∞

```bash
docker exec project-backup /scripts/backup.sh
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------------|----------|--------|
| `BACKUP_S3_BUCKET` | S3 –±–∞–∫–µ—Ç | `my-backups` |
| `BACKUP_S3_ENDPOINT` | S3 —ç–Ω–¥–ø–æ–∏–Ω—Ç | `s3.twcstorage.ru` |
| `BACKUP_S3_ACCESS_KEY` | –ö–ª—é—á –¥–æ—Å—Ç—É–ø–∞ | `your_key` |
| `BACKUP_S3_SECRET_KEY` | –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á | `your_secret` |

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|--------------|----------|
| `TZ` | `Europe/Moscow` | –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å |
| `BACKUP_PROJECT_NAME` | `project` | –ò–º—è –ø—Ä–æ–µ–∫—Ç–∞ |
| `BACKUP_SCHEDULE` | `0 5 * * *` | –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ cron |
| `BACKUP_RETENTION_COUNT` | `30` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–µ—Ä—Å–∏–π |
| `BACKUP_S3_REGION` | `ru-1` | –†–µ–≥–∏–æ–Ω S3 |
| `BACKUP_S3_FOLDER` | `{project}` | –ü–∞–ø–∫–∞ –≤ –±–∞–∫–µ—Ç–µ |
| `BACKUP_ON_START` | `false` | –ë–µ–∫–∞–ø –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ |
| `BACKUP_STOP_SERVICES` | - | –°–µ—Ä–≤–∏—Å—ã –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ |


## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

**–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:**
```bash
docker logs -f project-backup
docker exec project-backup tail -f /var/log/backup.log
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ S3:**
```bash
docker exec project-backup aws s3 ls s3://your-bucket --endpoint-url=https://your-endpoint
```


## –†–∞—Å–ø–∏—Å–∞–Ω–∏—è cron

```yaml
# –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 05:00
- BACKUP_SCHEDULE=0 5 * * *

# –ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
- BACKUP_SCHEDULE=0 */6 * * *

# –ö–∞–∂–¥–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ 02:00
- BACKUP_SCHEDULE=0 2 * * 0

# –ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
- BACKUP_SCHEDULE=*/30 * * * *
```

## –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

–î–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã:

```yaml
environment:
  - BACKUP_STOP_SERVICES=gitea postgres
```

**–í–∞–∂–Ω–æ:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä `backup` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –∏–∑ **—Ç–æ–≥–æ –∂–µ** `docker-compose.yaml` —á—Ç–æ –∏ —Ü–µ–ª–µ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã. Project name –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ Docker labels.

–°–µ—Ä–≤–∏—Å—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç—è—Ç—Å—è –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∞—Ä—Ö–∏–≤–∞.


## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

