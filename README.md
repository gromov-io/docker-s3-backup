# üóÑÔ∏è Universal Docker Backup Service

–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è Docker-–ø—Ä–æ–µ–∫—Ç–æ–≤ —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –≤ S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ tar.gz –∞—Ä—Ö–∏–≤–æ–≤ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (cron)
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –±—ç–∫–∞–ø–æ–≤ –≤ S3-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (Yandex Cloud, AWS S3, MinIO, Timeweb –∏ —Ç.–¥.)
- ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–µ—Ä–µ–¥ –±–µ–∫–∞–ø–æ–º –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –ó–∞–ø—É—Å–∫ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –±–µ–∫–∞–ø–∏—Ç—å:

```bash
git clone <this-repo> backup-system
cd your-project
cp -r backup-system/* .
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `docker-compose.yaml` –∏ —É–∫–∞–∂–∏—Ç–µ —Å–≤–æ–∏ –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```yaml
environment:
  # –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
  - BACKUP_PROJECT_NAME=my-project
  - BACKUP_S3_BUCKET=my-backups
  - BACKUP_S3_ENDPOINT=s3.twcstorage.ru
  - BACKUP_S3_ACCESS_KEY=your_access_key
  - BACKUP_S3_SECRET_KEY=your_secret_key
  
  # –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
  - BACKUP_SCHEDULE=0 3 * * *  # –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 03:00
  - BACKUP_RETENTION_DAYS=30
```

### 3. –ó–∞–ø—É—Å–∫

```bash
docker compose up -d backup
```

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:

```bash
docker compose logs -f backup
```

## üìã –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—Å–∞–Ω—ã –≤ `docker-compose.yaml` —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|----------|----------|--------|
| `BACKUP_S3_BUCKET` | –ò–º—è S3 –±–∞–∫–µ—Ç–∞ | `my-backups` |
| `BACKUP_S3_ENDPOINT` | –≠–Ω–¥–ø–æ–∏–Ω—Ç S3 —Å–µ—Ä–≤–∏—Å–∞ | `s3.twcstorage.ru` |
| `BACKUP_S3_ACCESS_KEY` | –ö–ª—é—á –¥–æ—Å—Ç—É–ø–∞ S3 | `your_key` |
| `BACKUP_S3_SECRET_KEY` | –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á S3 | `your_secret` |

### –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------------------|----------|
| `BACKUP_PROJECT_NAME` | `project` | –ò–º—è –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –∞—Ä—Ö–∏–≤–æ–≤ |
| `BACKUP_S3_FOLDER` | ` ` (–∫–æ—Ä–µ–Ω—å) | –ü–∞–ø–∫–∞ –≤–Ω—É—Ç—Ä–∏ –±–∞–∫–µ—Ç–∞ |
| `BACKUP_S3_REGION` | `ru-1` | –†–µ–≥–∏–æ–Ω S3 |
| `BACKUP_RETENTION_DAYS` | `30` | –î–Ω–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –±—ç–∫–∞–ø–æ–≤ |
| `BACKUP_SCHEDULE` | `0 3 * * *` | –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ cron |
| `BACKUP_ON_START` | `false` | –ë–µ–∫–∞–ø –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ |
| `BACKUP_STOP_SERVICES` | ` ` | –°–µ—Ä–≤–∏—Å—ã –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ |
| `BACKUP_COMPOSE_FILE` | ` ` | –ü—É—Ç—å –∫ compose-—Ñ–∞–π–ª—É |

## üõ†Ô∏è –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–µ—Ä–µ–¥ –±–µ–∫–∞–ø–æ–º

–î–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –∞—Ä—Ö–∏–≤–∞:

```yaml
environment:
  # ... –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ...
  - BACKUP_STOP_SERVICES=gitea gitea-db
  - BACKUP_COMPOSE_FILE=/backup-source/docker-compose.yml
```

**–í–∞–∂–Ω–æ:**
- –°–µ—Ä–≤–∏—Å—ã –±—É–¥—É—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ `docker compose down`
- –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∞—Ä—Ö–∏–≤–∞ —Å–µ—Ä–≤–∏—Å—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç—è—Ç—Å—è —á–µ—Ä–µ–∑ `docker compose up -d`
- –ï—Å–ª–∏ –±–µ–∫–∞–ø —É–ø–∞–¥–µ—Ç —Å –æ—à–∏–±–∫–æ–π - —Å–µ—Ä–≤–∏—Å—ã –≤—Å–µ —Ä–∞–≤–Ω–æ –∑–∞–ø—É—Å—Ç—è—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –±–µ–∫–∞–ø–∞

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–µ–∫–∞–ø–∏—Ç—Å—è —Ç–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è (`.`). –ß—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å:

```yaml
volumes:
  - /path/to/your/project:/backup-source:ro
  # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ volumes ...
```

### –ü—Ä–∏–º–µ—Ä—ã —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π (cron)

```yaml
# –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 03:00
- BACKUP_SCHEDULE=0 3 * * *

# –ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
- BACKUP_SCHEDULE=0 */6 * * *

# –ö–∞–∂–¥–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ 02:00
- BACKUP_SCHEDULE=0 2 * * 0

# –ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
- BACKUP_SCHEDULE=*/30 * * * *

# –î–≤–∞–∂–¥—ã –≤ –¥–µ–Ω—å: 03:00 –∏ 15:00
- BACKUP_SCHEDULE=0 3,15 * * *
```

### –¢–µ—Å—Ç–æ–≤—ã–π –±–µ–∫–∞–ø

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–µ–∫–∞–ø –≤—Ä—É—á–Ω—É—é:

```bash
docker compose exec backup /scripts/backup.sh
```

–ò–ª–∏ –≤–∫–ª—é—á–∏—Ç–µ –±–µ–∫–∞–ø –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ:

```yaml
- BACKUP_ON_START=true
```

## üìÇ –§–æ—Ä–º–∞—Ç –∞—Ä—Ö–∏–≤–æ–≤

–ê—Ä—Ö–∏–≤—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ:

```
{BACKUP_PROJECT_NAME}-backup-YYYY-MM-DD_HH-MM-SS.tar.gz
```

–ü—Ä–∏–º–µ—Ä: `my-project-backup-2025-10-22_03-00-00.tar.gz`

## üîß –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ backup.sh          # –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –±–µ–∫–∞–ø–∞
‚îú‚îÄ‚îÄ entrypoint.sh      # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
‚îú‚îÄ‚îÄ crontab            # –®–∞–±–ª–æ–Ω cron (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îú‚îÄ‚îÄ Dockerfile         # –û–±—Ä–∞–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
‚îú‚îÄ‚îÄ docker-compose.yaml # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞
‚îî‚îÄ‚îÄ README.md          # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

```bash
# –í—Å–µ –ª–æ–≥–∏
docker compose logs backup

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker compose logs -f backup

# –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ª–æ–≥–∏ –±–µ–∫–∞–ø–∞
docker compose exec backup cat /var/log/backup.log
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ S3

```bash
docker compose exec backup aws s3 ls s3://your-bucket --endpoint-url=https://your-endpoint
```

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –±–µ–∫–∞–ø–∞

```bash
docker compose exec backup /scripts/backup.sh
```

## üìä S3-–ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã

### Yandex Cloud Object Storage

```yaml
- BACKUP_S3_ENDPOINT=storage.yandexcloud.net
- BACKUP_S3_REGION=ru-central1
```

### Timeweb Cloud S3

```yaml
- BACKUP_S3_ENDPOINT=s3.twcstorage.ru
- BACKUP_S3_REGION=ru-1
```

### AWS S3

```yaml
- BACKUP_S3_ENDPOINT=s3.amazonaws.com
- BACKUP_S3_REGION=us-east-1
```

### MinIO (self-hosted)

```yaml
- BACKUP_S3_ENDPOINT=minio.your-domain.com
- BACKUP_S3_REGION=us-east-1
```

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º —Å–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

